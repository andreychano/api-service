# Q&A API Service

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RESTful API –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **Clean Architecture (Hexagonal Architecture)**, —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ **GORM**, –º–∏–≥—Ä–∞—Ü–∏–∏ —Å **Goose** –∏ –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—é —Å **Docker**.

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   **–Ø–∑—ã–∫:** Go 1.22 (std lib `net/http` —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π)
*   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 15
*   **ORM:** GORM
*   **–ú–∏–≥—Ä–∞—Ü–∏–∏:** Goose
*   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker, Docker Compose (Multi-stage build)
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** Environment variables (`.env`)
*   **–õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** `log/slog` (Structured JSON logging)
*   **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `testify`, `httptest` (Table-driven tests)

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ Standard Go Project Layout:

*   **`cmd/api`**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (Main). –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Dependency Injection).
*   **`internal/domain`**: –Ø–¥—Ä–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. –°–æ–¥–µ—Ä–∂–∏—Ç —Å—É—â–Ω–æ—Å—Ç–∏ (`Question`, `Answer`) –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤/—Å–µ—Ä–≤–∏—Å–æ–≤.
*   **`internal/service`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (Use Cases).
*   **`internal/adapters`**:
    *   `http`: HTTP-—Ö–µ–Ω–¥–ª–µ—Ä—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.
    *   `storage`: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (PostgreSQL + GORM).
*   **`migrations`**: SQL-—Ñ–∞–π–ª—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º—ã –ë–î.

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è **Docker** –∏ **Docker Compose**.

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone https://github.com/andreychano/api-service.git
cd api-service
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–±–µ—Ä–µ—Ç –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ–¥–Ω–∏–º–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä.

```bash
docker compose up --build -d
```

### 4. –ù–∞–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `goose`):

```bash
GOOSE_DRIVER=postgres GOOSE_DBSTRING="host=localhost port=5432 user=postgres_user password=secret_password dbname=my_database sslmode=disable" ~/go/bin/goose -dir migrations up
```
*(–ï—Å–ª–∏ –≤—ã –º–µ–Ω—è–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ)*

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

### 5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
docker compose down
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è HTTP-—Å–ª–æ—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ (mocks) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
go test -v ./...
```

---

## üì° API Endpoints

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `curl`. 

### –í–æ–ø—Ä–æ—Å—ã (Questions)

1.  **–°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å**
    *   `POST /questions`

    ```bash
    curl -X POST http://localhost:8080/questions \
    -H "Content-Type: application/json" \
    -d '{"text": "question text?"}'
    ```

2.  **–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã**
    *   `GET /questions`

    ```bash
    curl http://localhost:8080/questions
    ```

3.  **–ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ ID (–≤–º–µ—Å—Ç–µ —Å –æ—Ç–≤–µ—Ç–∞–º–∏)**
    *   `GET /questions/{id}`

    ```bash
    curl http://localhost:8080/questions/1
    ```

4.  **–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å**
    *   `DELETE /questions/{id}`
    *   *–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–∞ –∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –Ω–µ–≥–æ.*

    ```bash
    curl -X DELETE http://localhost:8080/questions/1
    ```

### –û—Ç–≤–µ—Ç—ã (Answers)

1.  **–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –∫ –≤–æ–ø—Ä–æ—Å—É**
    *   `POST /questions/{id}/answers`

    ```bash
    curl -X POST http://localhost:8080/questions/1/answers \
    -H "Content-Type: application/json" \
    -d '{"user_id": "user123", "text": "answer text"}'
    ```

2.  **–£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç**
    *   `DELETE /answers/{id}`

    ```bash
    curl -X DELETE http://localhost:8080/answers/1
    ```
